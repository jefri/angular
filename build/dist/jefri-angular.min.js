/* JEFRi AngularJS - v1.0.2 - 2012-12-24
* http://www.jefri.org
* Copyright (c) 2012 David Souther; Licensed MIT */
(function(){var e,t,n=function(e){e.__event_handler=e.__event_handler||[],e.__event_advisor=e.__event_advisor||[]},r=function(e){n(this),this.__event_handler.push(e)};if(window.$!==window.jQuery)throw"Seriously, load jQuery first, please.";angular.module("jQuery",[]).factory("jQuery",function(){return window.jQuery}),angular.module("JEFRi",["jQuery"]),angular.module("JEFRi").factory("JEFRi",function(){var e,t;return e=new JEFRi.Runtime("context.json"),t=JEFRi.Runtime.prototype,t.run=function(e,t){var n,r,i;return n=new window.JEFRi.Transaction,n.add(t),r={remote:this.settings.ENDPOINT,runtime:this},i=new window.JEFRi.Stores.PostStore(r),i.execute(e,n)},t.save=function(e){return this.run("persist",e)},t.get=function(e){return e==null&&(e={}),this.run("get",e)},t.config=function(e){e==null&&(e="/"),this.settings.ENDPOINT=e},e.settings={ENDPOINT:"/"},e}),e=function(){return{restrict:"A",link:function(e,t,n){var i,s,o,u;i=n.jefriProperty.split("."),s=i[0],o=i[1],s=e[s];switch(t[0].nodeName){case"SELECT":u=function(e){t.find("option").filter(function(){return $(this).attr("value")===e||$(this).text()===e}).attr("selected",!0)},t.change(function(){s[o](t.val());try{e.$apply()}catch(n){}}),r.call(s.modified=s.modified||{},function(e,t){var n;_(e).isArray()&&(n=e,e=n[0],t=n[1]),e===o&&u(t)},s),setTimeout(function(){return u(s[o]())},0);break;case"INPUT":if("radio"===t.attr("type")){u=function(e){e===t.val()&&t.attr("checked","checked")},t.change(function(){s[o](t.val());try{e.$apply()}catch(n){}}),r.call(s.modified=s.modified||{},function(e,t){var n;_(e).isArray()&&(n=e,e=n[0],t=n[1]),e===o&&u(t)},s),setTimeout(function(){return u(s[o]())},0);return};case"INPUT":case"TEXTAREA":t.val(s[o]()),t.change(function(){s[o](t.val())}),r.call(s.modified=s.modified||{},function(){t.val(s[o]())},s);break;case"SPAN":case"DIV":case"P":default:t.text(s[o]()),r.call(s.modified=s.modified||{},function(){t.text(s[o]())},s)}}}},angular.module("JEFRi").directive("jefriProperty",["jQuery",e]),t=function(e,t){return{restrict:"E",template:'<span><span ng:hide="editing" ng:click="edit()">{{value}}</span><span ng:show="editing && property"><input type="text" name="value" ng:required ng-model="value" ui-event="{blur:\'save()\'}" /></span><span ng:show="editing && relationship"><select class="relationship" ng:model="to_id" ui-event="{blur:\'save()\'}"><option disabled>{{prompt}}:</option><option ng:repeat="entity in options" value="{{ entity.id }}">{{ entity.name }}</option></select></span></span>',replace:!0,scope:!0,controller:function(e){e.editing=!1,e.edit=function(){e.editing=!0},e.save=function(){e.editing=!1}},link:function(e,n,r){var i,s;i=e[r.entity||"entity"],s=i._definition(),s.properties[r.property]?(e.property=!0,e.value=i[r.property]()||r["default"],e.$watch("value",function(){i[r.property](e.value)})):s.relationships[r.property]&&(e.relationship=!0,e.prompt=r.prompt,e.to_id=i[r.property]().id(),e.value=i[r.property]()[r.display](),e.options=_(t.find(s.relationships[r.property].to.type)).map(function(e){return{id:e.id(),name:e[r.display]()}}),e.$watch("to_id",function(){var n;n=_(t.find({_type:s.relationships[r.property].to.type})).filter(function(t){return t.id()===e.to_id}),i[r.property](n[0]),e.value=i[r.property]()[r.display]()}))}}},angular.module("JEFRi").directive("inline",["jQuery","JEFRi",t])}).call(this);
